<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hw-10</title>
</head>
<body>
    <script>
        const toDo = {
            _list: [],
            get list () {
                return this._list;
            },
            add (text) {
                const id = Date.now();
                if (typeof text === 'string') {
                    text = text.trim();
                }
                //проверка на уникальность задачи
                if (this.isUnique(text)) {
                    this.list.push({
                        text,
                        id,
                        isDone: false,
                    });
                }
            },
            edit (id, newText, isDone = false) {
                const index = this.getNoteIndex(id);
                if (typeof newText === 'string') {
                    newText = newText.trim();
                }
                //если задача с таким id есть и она уникальна
                if (index != -1 && this.isUnique(newText, isDone)) {
                    //спрашиваем разрешение
                    if (this.allow('Изменить выбранное задание?')) {
                        this.list[index].text = newText;
                        this.list[index].isDone = isDone;
                    }
                }
                return this.list;
            },
            delete (id) {
                const index = this.getNoteIndex(id);
                //если задача с таким id есть и разрешение на удаление
                if (index != -1 && this.allow('Уверены, что хотите удалить?')) {
                    return this.list.splice(index, 1);
                }
            },
            ready (id) {
                const index = this.getNoteIndex(id);
                if (index != -1) {
                    this.list[index].isDone = true;
                }
                return this.list;
            },
            howMany () {
                return {
                    all: this.list.length,
                    completed: this.list.reduce(function(acc, elem) {
                        return elem.isDone ? ++acc : acc;
                    }, 0),
                    left: this.list.reduce(function(acc, elem) {
                        return elem.isDone ? acc : ++acc;
                    }, 0),
                };
            },
            isUnique (newText, newStatus = false) {
                const created = this.list.map(elem => {
                    let {text, isDone:status} = elem;
                    return `${text}/${status}`;
                })
                return created.includes(`${newText}/${newStatus}`) ? false : true;
            },
            getNoteIndex (value) {
                return this.list.findIndex(function (obj) {
                    if (obj.id == value) return obj;
                });
            },
            allow: (massage) => confirm(massage),
        }

        Object.defineProperty(toDo, '_list', {
            writable: false,
            enumerable: true,
            configurable: false,
        });
        Object.freeze(toDo);
    </script>
</body>
</html>